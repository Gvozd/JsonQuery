/*! JsonQuery - v0.1.0 - 2013-04-09
* https://github.com/Gvozd/JsonQuery/
* Copyright (c) 2013 Gvozdev Viktor; Licensed MIT */
(function(t){"use strict";function n(t,e,r,i){if(2===arguments.length)return n(t,{":root":e},[],[]);if(4!==arguments.length)throw Error("Need 2 or 4 arguments");return Object.keys(e).forEach(function(s){var o,l;o=r.slice(),o.push({obj:e[s],key:s}),l=t(o.slice()),"function"==typeof l.next&&"object"==typeof e[s]&&null!==e[s]&&n(l.next,e[s],o.slice(),i),l.ok&&i.push(o.slice())}),i}function e(){var t=function t(){return{ok:!0,next:null}};return t.toString=function(){return"filterAny()"},t}function r(){var t=function t(){return{ok:!0,next:t}};return t.toString=function(){return"filterDeeperAny()"},t}function i(){var t=function t(t){return 2>t.length?{ok:!1,next:null}:{ok:Array.isArray(t[t.length-2].obj)&&0===parseInt(t[t.length-1].key,10),next:null}};return t.toString=function(){return"firstChild()"},t}function s(){var t=function t(t){return 2>t.length?{ok:!1,next:null}:{ok:Array.isArray(t[t.length-2].obj)&&parseInt(t[t.length-1].key,10)===t[t.length-2].obj.length-1,next:null}};return t.toString=function(){return"lastChild()"},t}function o(t){var n=function n(n){return{ok:n.pop().key===t,next:null}};return n.toString=function(){return"filterName("+JSON.stringify(t)+")"},n}function l(t){var n,e,r,i,s,o=/^(-?\d*)n(?=[+\-]|\))\+?(-?\d+)?$/;if(t=t.match(/\((.*)\)/)[1],"even"===t)n=2,e=1;else if("odd"===t)n=2,e=0;else if(null!==t.match(/^-?\d+$/))n=0,e=parseInt(t||0,10)-1;else{if(null===t.match(o))throw Error("Lexical error on line 1. Unrecognized expression.\n:nth-child("+t+")");s=t.match(o),n=parseInt(s[1],10),n=isNaN(n)?parseInt(s[1]+"1",10):n,e=parseInt(s[2]||0,10)-1}var l=function l(t){if(2>t.length)return{ok:!1,next:null};if(i=t[t.length-2].obj,Array.isArray(i))for(r=e;i.length>r&&r>=0;r+=n){if(parseInt(t[t.length-1].key,10)===r)return{ok:!0,next:null};if(0===n)break}return{ok:!1,next:null}};return l.toString=function(){return"nthChild()"},l}function h(t){var n,e,r,i,s,o=/^(-?\d*)n(?=[+\-]|\))\+?(-?\d+)?$/;if(t=t.match(/\((.*)\)/)[1],"even"===t)n=2,e=1;else if("odd"===t)n=2,e=0;else if(null!==t.match(/^-?\d+$/))n=0,e=parseInt(t||0,10)-1;else{if(null===t.match(o))throw Error("Lexical error on line 1. Unrecognized expression.\n:nth-child("+t+")");s=t.match(o),n=parseInt(s[1],10),n=isNaN(n)?parseInt(s[1]+"1",10):n,e=parseInt(s[2]||0,10)-1}var l=function l(t){if(2>t.length)return{ok:!1,next:null};if(i=t[t.length-2].obj,Array.isArray(i))for(r=i.length-1-e;i.length>r&&r>=0;r-=n){if(parseInt(t[t.length-1].key,10)===r)return{ok:!0,next:null};if(0===n)break}return{ok:!1,next:null}};return l.toString=function(){return"nthChild()"},l}function u(){var t=function t(t){return{ok:1===t.length}};return t.toString=function(){return"filterRoot()"},t}function c(t){function n(t){return Array.isArray(t)?"array":null===t?"null":typeof t}var e=function e(e){return{ok:n(e.pop().obj)===t,next:null}};return e.toString=function(){return"filterType("+JSON.stringify(t)+")"},e}function a(t,n){var e,r,i;if(arguments.length>2){for(e=a(t,n),r=2;arguments.length>r;r+=1)e=a(e,arguments[r]);return i=Array.prototype.map.call(arguments,JSON.stringify).join(", "),e.toString=function(){return"unionAnd("+i+")"},e}return"function"!=typeof t||"function"!=typeof n?null:(e=function e(e){var r,i;return r=t(e.slice()),i=n(e.slice()),r.ok&&i.ok?{ok:!0,next:a(r.next,i.next)}:{ok:!1,next:a(r.next,i.next)}},e.toString=function(){return"unionAnd("+t+", "+n+")"},e)}function f(t,n){var e,r,i;if(arguments.length>2){for(e=f(t,n),r=2;arguments.length>r;r+=1)e=f(e,arguments[r]);return i=Array.prototype.map.call(arguments,JSON.stringify).join(", "),e.toString=function(){return"childrenUnion("+i+")"},e}return"function"!=typeof t||"function"!=typeof n?null:(e=function e(e){var r=t(e.slice());return r.ok?"function"==typeof r.next?{ok:!1,next:p(f(r.next,n),n)}:{ok:!1,next:n}:"function"==typeof r.next?{ok:!1,next:f(r.next,n)}:{ok:!1,next:null}},e.toString=function(){return"childrenUnion("+t+", "+n+")"},e)}function y(t,n){var e,i,s;if(arguments.length>2){for(e=y(t,n),i=2;arguments.length>i;i+=1)e=y(e,arguments[i]);return s=Array.prototype.map.call(arguments,JSON.stringify).join(", "),e.toString=function(){return"descendantUnion("+s+")"},e}return"function"!=typeof t||"function"!=typeof n?null:(e=p(f(t,n),f(t,r(),n)),e.toString=function(){return"descendantUnion("+t+","+n+")"},e)}function p(t,n){var e,r,i;if(arguments.length>2){for(e=p(t,n),r=2;arguments.length>r;r+=1)e=p(e,arguments[r]);return i=Array.prototype.map.call(arguments,JSON.stringify).join(", "),e.toString=function(){return"unionOr("+i+")"},e}return"function"==typeof t&&"function"!=typeof n?t:"function"!=typeof t&&"function"==typeof n?n:"function"!=typeof t&&"function"!=typeof n?null:(e=function e(e){var r,i;return r=t(e.slice()),i=n(e.slice()),r.ok||i.ok?{ok:!0,next:p(r.next,i.next)}:{ok:!1,next:p(r.next,i.next)}},e.toString=function(){return"unionOr("+t+","+n+")"},e)}function g(t,e){if(!(this instanceof g))return new g(t,e);var r=n(d.parse(t),e);return this.length=r.length,r.forEach(function(t,n){this[n]=t[t.length-1].obj},this),this}var d=function(){function t(){this.yy={}}var n={trace:function(){},yy:{},symbols_:{error:2,ruleset:3,selector:4,comma:5,EOF:6,simple_selector:7,space:8,">":9,"*":10,identity:11,".":12,root:13,"first-child":14,"last-child":15,"nth-child":16,"nth-last-child":17,$accept:0,$end:1},terminals_:{2:"error",5:"comma",6:"EOF",8:"space",9:">",10:"*",11:"identity",12:".",13:"root",14:"first-child",15:"last-child",16:"nth-child",17:"nth-last-child"},productions_:[0,[3,1],[3,3],[3,2],[4,1],[4,3],[4,3],[7,2],[7,1],[7,1],[7,2],[7,1],[7,1],[7,1],[7,1],[7,1]],performAction:function(t,n,r,g,d,m){var x=m.length-1;switch(d){case 1:this.$=m[x];break;case 2:this.$=p(m[x-2],m[x]);break;case 3:return m[x-1];case 4:this.$=p(a(u(),m[x]),y(u(),m[x]));break;case 5:this.$=y(m[x-2],m[x]);break;case 6:this.$=f(m[x-2],m[x]);break;case 7:this.$=a(m[x-1],m[x]);break;case 8:this.$=e();break;case 9:this.$=c(m[x]);break;case 10:this.$=o(m[x]);break;case 11:this.$=u();break;case 12:this.$=i();break;case 13:this.$=s();break;case 14:this.$=l(m[x]);break;case 15:this.$=h(m[x])}},table:[{3:1,4:2,7:3,10:[1,4],11:[1,5],12:[1,6],13:[1,7],14:[1,8],15:[1,9],16:[1,10],17:[1,11]},{1:[3],5:[1,12],6:[1,13]},{1:[2,1],5:[2,1],6:[2,1],8:[1,14],9:[1,15]},{1:[2,4],5:[2,4],6:[2,4],7:16,8:[2,4],9:[2,4],10:[1,4],11:[1,5],12:[1,6],13:[1,7],14:[1,8],15:[1,9],16:[1,10],17:[1,11]},{1:[2,8],5:[2,8],6:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[2,8],17:[2,8]},{1:[2,9],5:[2,9],6:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[2,9],17:[2,9]},{11:[1,17]},{1:[2,11],5:[2,11],6:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],17:[2,11]},{1:[2,12],5:[2,12],6:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],17:[2,12]},{1:[2,13],5:[2,13],6:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],17:[2,13]},{1:[2,14],5:[2,14],6:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],17:[2,14]},{1:[2,15],5:[2,15],6:[2,15],8:[2,15],9:[2,15],10:[2,15],11:[2,15],12:[2,15],13:[2,15],14:[2,15],15:[2,15],16:[2,15],17:[2,15]},{4:18,7:3,10:[1,4],11:[1,5],12:[1,6],13:[1,7],14:[1,8],15:[1,9],16:[1,10],17:[1,11]},{1:[2,3],5:[2,3],6:[2,3]},{7:19,10:[1,4],11:[1,5],12:[1,6],13:[1,7],14:[1,8],15:[1,9],16:[1,10],17:[1,11]},{7:20,10:[1,4],11:[1,5],12:[1,6],13:[1,7],14:[1,8],15:[1,9],16:[1,10],17:[1,11]},{1:[2,7],5:[2,7],6:[2,7],7:16,8:[2,7],9:[2,7],10:[1,4],11:[1,5],12:[1,6],13:[1,7],14:[1,8],15:[1,9],16:[1,10],17:[1,11]},{1:[2,10],5:[2,10],6:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[2,10],17:[2,10]},{1:[2,2],5:[2,2],6:[2,2],8:[1,14],9:[1,15]},{1:[2,5],5:[2,5],6:[2,5],7:16,8:[2,5],9:[2,5],10:[1,4],11:[1,5],12:[1,6],13:[1,7],14:[1,8],15:[1,9],16:[1,10],17:[1,11]},{1:[2,6],5:[2,6],6:[2,6],7:16,8:[2,6],9:[2,6],10:[1,4],11:[1,5],12:[1,6],13:[1,7],14:[1,8],15:[1,9],16:[1,10],17:[1,11]}],defaultActions:{},parseError:function(t){throw Error(t)},parse:function(t){function n(){var t;return t=e.lexer.lex()||1,"number"!=typeof t&&(t=e.symbols_[t]||t),t}var e=this,r=[0],i=[null],s=[],o=this.table,l="",h=0,u=0,c=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,this.lexer.yylloc===undefined&&(this.lexer.yylloc={});var a=this.lexer.yylloc;s.push(a);var f=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var y,p,g,d,m,x,k,_,v,b={};;){if(g=r[r.length-1],this.defaultActions[g]?d=this.defaultActions[g]:((null===y||y===undefined)&&(y=n()),d=o[g]&&o[g][y]),d===undefined||!d.length||!d[0]){var S="";if(!c){v=[];for(x in o[g])this.terminals_[x]&&x>2&&v.push("'"+this.terminals_[x]+"'");S=this.lexer.showPosition?"Parse error on line "+(h+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[y]||y)+"'":"Parse error on line "+(h+1)+": Unexpected "+(1==y?"end of input":"'"+(this.terminals_[y]||y)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[y]||y,line:this.lexer.yylineno,loc:a,expected:v})}}if(d[0]instanceof Array&&d.length>1)throw Error("Parse Error: multiple actions possible at state: "+g+", token: "+y);switch(d[0]){case 1:r.push(y),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(d[1]),y=null,p?(y=p,p=null):(u=this.lexer.yyleng,l=this.lexer.yytext,h=this.lexer.yylineno,a=this.lexer.yylloc,c>0&&c--);break;case 2:if(k=this.productions_[d[1]][1],b.$=i[i.length-k],b._$={first_line:s[s.length-(k||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(k||1)].first_column,last_column:s[s.length-1].last_column},f&&(b._$.range=[s[s.length-(k||1)].range[0],s[s.length-1].range[1]]),m=this.performAction.call(b,l,u,h,this.yy,d[1],i,s),m!==undefined)return m;k&&(r=r.slice(0,2*-1*k),i=i.slice(0,-1*k),s=s.slice(0,-1*k)),r.push(this.productions_[d[1]][0]),i.push(b.$),s.push(b._$),_=o[r[r.length-2]][r[r.length-1]],r.push(_);break;case 3:return!0}}return!0}},r=function(){var t={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw Error(t);this.yy.parser.parseError(t,n)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var n=t.match(/(?:\r\n?|\n).*/g);return n?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var n=t.length,e=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-n-1),this.offset-=n;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),e.length-1&&(this.yylineno-=e.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:e?(e.length===r.length?this.yylloc.first_column:0)+r[r.length-e.length].length-e[0].length:this.yylloc.first_column-n},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-n]),this},more:function(){return this._more=!0,this},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return 20>t.length&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),n=Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+n+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,n,e,r,i;this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),o=0;s.length>o&&(e=this._input.match(this.rules[s[o]]),!e||n&&!(e[0].length>n[0].length)||(n=e,r=o,this.options.flex));o++);return n?(i=n[0].match(/(?:\r\n?|\n).*/g),i&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+n[0].length},this.yytext+=n[0],this.match+=n[0],this.matches=n,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(n[0].length),this.matched+=n[0],t=this.performAction.call(this,this.yy,this,s[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),t?t:undefined):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t!==undefined?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)},options:{},performAction:function(t,n,e,r){switch(e){case 0:return 11;case 1:return n.yytext=this.matches[1].replace(/\\"/g,'"'),11;case 2:return n.yytext=this.matches[1].replace(/\\'/g,"'"),11;case 3:return 13;case 4:return 14;case 5:return 15;case 6:return 16;case 7:return 17;case 8:return 9;case 9:return 8;case 10:return 12;case 11:return 10;case 12:return 5;case 13:return 6}},rules:[/^(?:(\w|\d)+)/,/^(?:"((?:\w|\d|\\")+)")/,/^(?:'((?:\w|\d|\\')+)')/,/^(?::root)/,/^(?::first-child)/,/^(?::last-child)/,/^(?::nth-child\((odd|even|-?\d+|-?\d*n(?=[+\-]|\))\+?(-?\d+)?)\))/,/^(?::nth-last-child\((odd|even|-?\d+|-?\d*n(?=[+\-]|\))\+?(-?\d+)?)\))/,/^(?:\s*>\s*)/,/^(?:\s+)/,/^(?:\.)/,/^(?:\*)/,/^(?:\s*,\s*)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return t}();return n.lexer=r,t.prototype=n,n.Parser=t,new t}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=d,exports.Parser=d.Parser,exports.parse=function(){return d.parse.apply(d,arguments)},exports.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),process.exit(1));var n=require("fs").readFileSync(require("path").normalize(t[1]),"utf8");return exports.parser.parse(n)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1))),g.prototype=Array.prototype,"object"==typeof module&&"object"==typeof module.exports?module.exports=g:"function"==typeof define&&define.amd&&define("JsonQuery",[],function(){return g}),"object"==typeof t&&"object"==typeof t.document&&(t.JsonQuery=t.$=g)})(this);