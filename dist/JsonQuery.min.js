/*! JsonQuery - v0.1.0 - 2013-04-09
* https://github.com/Gvozd/JsonQuery/
* Copyright (c) 2013 Gvozdev Viktor; Licensed MIT */
(function(t){"use strict";function n(t,e,i,r){if(2===arguments.length)return n(t,{":root":e},[],[]);if(4!==arguments.length)throw Error("Need 2 or 4 arguments");return Object.keys(e).forEach(function(s){var o,l;o=i.slice(),o.push({obj:e[s],key:s}),l=t(o.slice()),"function"==typeof l.next&&"object"==typeof e[s]&&null!==e[s]&&n(l.next,e[s],o.slice(),r),l.ok&&r.push(o.slice())}),r}function e(){var t=function t(){return{ok:!0,next:null}};return t.toString=function(){return"filterAny()"},t}function i(){var t=function t(){return{ok:!0,next:t}};return t.toString=function(){return"filterDeeperAny()"},t}function r(t){var n=function n(n){return{ok:n.pop().key===t,next:null}};return n.toString=function(){return"filterName("+JSON.stringify(t)+")"},n}function s(){var t=function t(t){return{ok:1===t.length}};return t.toString=function(){return"filterRoot()"},t}function o(t){function n(t){return Array.isArray(t)?"array":null===t?"null":typeof t}var e=function e(e){return{ok:n(e.pop().obj)===t,next:null}};return e.toString=function(){return"filterType("+JSON.stringify(t)+")"},e}function l(t,n){var e,i,r;if(arguments.length>2){for(e=l(t,n),i=2;arguments.length>i;i+=1)e=l(e,arguments[i]);return r=Array.prototype.map.call(arguments,JSON.stringify).join(", "),e.toString=function(){return"unionAnd("+r+")"},e}return"function"!=typeof t||"function"!=typeof n?null:(e=function e(e){var i,r;return i=t(e.slice()),r=n(e.slice()),i.ok&&r.ok?{ok:!0,next:l(i.next,r.next)}:{ok:!1,next:l(i.next,r.next)}},e.toString=function(){return"unionAnd("+t+", "+n+")"},e)}function u(t,n){var e,i,r;if(arguments.length>2){for(e=u(t,n),i=2;arguments.length>i;i+=1)e=u(e,arguments[i]);return r=Array.prototype.map.call(arguments,JSON.stringify).join(", "),e.toString=function(){return"childrenUnion("+r+")"},e}return"function"!=typeof t||"function"!=typeof n?null:(e=function e(e){var i=t(e.slice());return i.ok?"function"==typeof i.next?{ok:!1,next:c(u(i.next,n),n)}:{ok:!1,next:n}:"function"==typeof i.next?{ok:!1,next:u(i.next,n)}:{ok:!1,next:null}},e.toString=function(){return"childrenUnion("+t+", "+n+")"},e)}function h(t,n){var e,r,s;if(arguments.length>2){for(e=h(t,n),r=2;arguments.length>r;r+=1)e=h(e,arguments[r]);return s=Array.prototype.map.call(arguments,JSON.stringify).join(", "),e.toString=function(){return"descendantUnion("+s+")"},e}return"function"!=typeof t||"function"!=typeof n?null:(e=c(u(t,n),u(t,i(),n)),e.toString=function(){return"descendantUnion("+t+","+n+")"},e)}function c(t,n){var e,i,r;if(arguments.length>2){for(e=c(t,n),i=2;arguments.length>i;i+=1)e=c(e,arguments[i]);return r=Array.prototype.map.call(arguments,JSON.stringify).join(", "),e.toString=function(){return"unionOr("+r+")"},e}return"function"==typeof t&&"function"!=typeof n?t:"function"!=typeof t&&"function"==typeof n?n:"function"!=typeof t&&"function"!=typeof n?null:(e=function e(e){var i,r;return i=t(e.slice()),r=n(e.slice()),i.ok||r.ok?{ok:!0,next:c(i.next,r.next)}:{ok:!1,next:c(i.next,r.next)}},e.toString=function(){return"unionOr("+t+","+n+")"},e)}function a(t,e){if(!(this instanceof a))return new a(t,e);var i=n(f.parse(t),e);return this.length=i.length,i.forEach(function(t,n){this[n]=t[t.length-1].obj},this),this}var f=function(){function t(){this.yy={}}var n={trace:function(){},yy:{},symbols_:{error:2,ruleset:3,selector:4,comma:5,EOF:6,root:7,simple_selector:8,space:9,">":10,"*":11,identity:12,".":13,$accept:0,$end:1},terminals_:{2:"error",5:"comma",6:"EOF",7:"root",9:"space",10:">",11:"*",12:"identity",13:"."},productions_:[0,[3,1],[3,3],[3,2],[4,1],[4,1],[4,3],[4,3],[8,1],[8,1],[8,2],[8,3]],performAction:function(t,n,i,a,f,y){var p=y.length-1;switch(f){case 1:this.$=y[p];break;case 2:this.$=c(y[p-2],y[p]);break;case 3:return y[p-1];case 4:this.$=s();break;case 5:this.$=c(l(s(),y[p]),h(s(),y[p]));break;case 6:this.$=h(y[p-2],y[p]);break;case 7:this.$=u(y[p-2],y[p]);break;case 8:this.$=e();break;case 9:this.$=o(y[p]);break;case 10:this.$=r(y[p]);break;case 11:this.$=l(y[p-2],r(y[p]))}},table:[{3:1,4:2,7:[1,3],8:4,11:[1,5],12:[1,6],13:[1,7]},{1:[3],5:[1,8],6:[1,9]},{1:[2,1],5:[2,1],6:[2,1],9:[1,10],10:[1,11]},{1:[2,4],5:[2,4],6:[2,4],9:[2,4],10:[2,4]},{1:[2,5],5:[2,5],6:[2,5],9:[2,5],10:[2,5],13:[1,12]},{1:[2,8],5:[2,8],6:[2,8],9:[2,8],10:[2,8],13:[2,8]},{1:[2,9],5:[2,9],6:[2,9],9:[2,9],10:[2,9],13:[2,9]},{12:[1,13]},{4:14,7:[1,3],8:4,11:[1,5],12:[1,6],13:[1,7]},{1:[2,3],5:[2,3],6:[2,3]},{8:15,11:[1,5],12:[1,6],13:[1,7]},{8:16,11:[1,5],12:[1,6],13:[1,7]},{12:[1,17]},{1:[2,10],5:[2,10],6:[2,10],9:[2,10],10:[2,10],13:[2,10]},{1:[2,2],5:[2,2],6:[2,2],9:[1,10],10:[1,11]},{1:[2,6],5:[2,6],6:[2,6],9:[2,6],10:[2,6],13:[1,12]},{1:[2,7],5:[2,7],6:[2,7],9:[2,7],10:[2,7],13:[1,12]},{1:[2,11],5:[2,11],6:[2,11],9:[2,11],10:[2,11],13:[2,11]}],defaultActions:{},parseError:function(t){throw Error(t)},parse:function(t){function n(){var t;return t=e.lexer.lex()||1,"number"!=typeof t&&(t=e.symbols_[t]||t),t}var e=this,i=[0],r=[null],s=[],o=this.table,l="",u=0,h=0,c=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,this.lexer.yylloc===undefined&&(this.lexer.yylloc={});var a=this.lexer.yylloc;s.push(a);var f=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var y,p,g,m,x,d,_,k,v,b={};;){if(g=i[i.length-1],this.defaultActions[g]?m=this.defaultActions[g]:((null===y||y===undefined)&&(y=n()),m=o[g]&&o[g][y]),m===undefined||!m.length||!m[0]){var S="";if(!c){v=[];for(d in o[g])this.terminals_[d]&&d>2&&v.push("'"+this.terminals_[d]+"'");S=this.lexer.showPosition?"Parse error on line "+(u+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[y]||y)+"'":"Parse error on line "+(u+1)+": Unexpected "+(1==y?"end of input":"'"+(this.terminals_[y]||y)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[y]||y,line:this.lexer.yylineno,loc:a,expected:v})}}if(m[0]instanceof Array&&m.length>1)throw Error("Parse Error: multiple actions possible at state: "+g+", token: "+y);switch(m[0]){case 1:i.push(y),r.push(this.lexer.yytext),s.push(this.lexer.yylloc),i.push(m[1]),y=null,p?(y=p,p=null):(h=this.lexer.yyleng,l=this.lexer.yytext,u=this.lexer.yylineno,a=this.lexer.yylloc,c>0&&c--);break;case 2:if(_=this.productions_[m[1]][1],b.$=r[r.length-_],b._$={first_line:s[s.length-(_||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(_||1)].first_column,last_column:s[s.length-1].last_column},f&&(b._$.range=[s[s.length-(_||1)].range[0],s[s.length-1].range[1]]),x=this.performAction.call(b,l,h,u,this.yy,m[1],r,s),x!==undefined)return x;_&&(i=i.slice(0,2*-1*_),r=r.slice(0,-1*_),s=s.slice(0,-1*_)),i.push(this.productions_[m[1]][0]),r.push(b.$),s.push(b._$),k=o[i[i.length-2]][i[i.length-1]],i.push(k);break;case 3:return!0}}return!0}},i=function(){var t={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw Error(t);this.yy.parser.parseError(t,n)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var n=t.match(/(?:\r\n?|\n).*/g);return n?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var n=t.length,e=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-n-1),this.offset-=n;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),e.length-1&&(this.yylineno-=e.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:e?(e.length===i.length?this.yylloc.first_column:0)+i[i.length-e.length].length-e[0].length:this.yylloc.first_column-n},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-n]),this},more:function(){return this._more=!0,this},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return 20>t.length&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),n=Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+n+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,n,e,i,r;this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),o=0;s.length>o&&(e=this._input.match(this.rules[s[o]]),!e||n&&!(e[0].length>n[0].length)||(n=e,i=o,this.options.flex));o++);return n?(r=n[0].match(/(?:\r\n?|\n).*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+n[0].length},this.yytext+=n[0],this.match+=n[0],this.matches=n,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(n[0].length),this.matched+=n[0],t=this.performAction.call(this,this.yy,this,s[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),t?t:undefined):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t!==undefined?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)},options:{},performAction:function(t,n,e,i){switch(e){case 0:return 12;case 1:return n.yytext=this.matches[1].replace(/\\"/g,'"'),12;case 2:return n.yytext=this.matches[1].replace(/\\'/g,"'"),12;case 3:return 7;case 4:return 10;case 5:return 9;case 6:return 13;case 7:return 11;case 8:return 5;case 9:return 6}},rules:[/^(?:(\w|\d)+)/,/^(?:"((?:\w|\d|\\")+)")/,/^(?:'((?:\w|\d|\\')+)')/,/^(?::root)/,/^(?:\s*>\s*)/,/^(?:\s+)/,/^(?:\.)/,/^(?:\*)/,/^(?:\s*,\s*)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9],inclusive:!0}}};return t}();return n.lexer=i,t.prototype=n,n.Parser=t,new t}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=f,exports.Parser=f.Parser,exports.parse=function(){return f.parse.apply(f,arguments)},exports.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),process.exit(1));var n=require("fs").readFileSync(require("path").normalize(t[1]),"utf8");return exports.parser.parse(n)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1))),a.prototype=Array.prototype,"object"==typeof module&&"object"==typeof module.exports?module.exports=a:"function"==typeof define&&define.amd&&define("JsonQuery",[],function(){return a}),"object"==typeof t&&"object"==typeof t.document&&(t.JsonQuery=t.$=a)})(this);